---
theme: "Beige"
transition: "convex"
highlightTheme: "atom-one-dark"
# logoImg: "http://linyu.dynv6.net:9001/images/ppt/html5.png"
logoImg: "http://git.cairenhui.com/uploads/-/system/appearance/logo/1/logo.png"
slideNumber: false
title: "2019 å‰ç«¯åˆ†äº«"
---

## å‰ç«¯å¹´åº¦åˆ†äº«

å¾®æœåŠ¡ Â· Docker {style=font-size:36px;color:#999}

<br><br>

<a href="mailto://linyu0710@cairenhui.com">
  ğŸ“©
  linyu0710@cairenhui.com
</a>

ğŸ¼ ğŸš´ ğŸ€ ğŸ“·

---

## å›é¡¾

Web å¼€å‘

---

å·¨çŸ³ (Monolith)

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/QQ20191216-112133@2x.png){style=width:80%;border-radius:15px}

---

å‰åç«¯åˆ†ç¦» (Frontend & Backend)

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/QQ20191216-122420@2x.png){style=width:80%;border-radius:15px}

---

åç«¯å¾®æœåŠ¡ (Microservice)

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/QQ20191216-123936@2x.png){style=width:80%;border-radius:15px}

---

## å›é¡¾

å‰ç«¯å¼€å‘

---

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/js-modules.png){style=width:90%;border-radius:15px}

---

### ğŸ¤” Why æ¨¡å—åŒ–?

<br>

ğŸš« æµè§ˆå™¨ä¸æ”¯æŒ{.fragment}

ğŸ£ ä»£ç æ‹†åˆ†å¤ç”¨{.fragment}

ğŸ¤ ç®¡ç†ä¾èµ–å…³ç³»{.fragment}

ğŸš¥ æŒ‰åºåŠ è½½èµ„æº{.fragment}

---

ğŸ‘½ é«˜ç§‘æŠ€

â¬‡

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/module-bundlers.png){style=width:80%;border-radius:15px}

â¬‡

ğŸ˜€ æ¥åœ°æ°”

---

### ğŸ¤” åˆWhyå·¥ç¨‹åŒ–æ‰“åŒ…ï¼Ÿ

<br>

ğŸ™ æ–‡ä»¶åˆå¹¶å‡å°‘è¯·æ±‚æ•°{.fragment}

ğŸ’¡ å˜æ›´æ–‡ä»¶åç¼“å­˜æ§åˆ¶{.fragment}

ğŸ“š è¯­æ³•è½¬è¯‘é€‚é…å¤šå¹³å°{.fragment}

ğŸ» ä¼˜åŒ–å‹ç¼©ä¸ªæ€§åŒ–é…ç½®{.fragment}

---

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/QQ20191216-152455@2x.png){style=width:80%;border-radius:15px}

ğŸ‘¬ [CRH Vue Components](http://linyupark.github.io/projects/storybook-crh-vue/)

---

### ğŸ¤” å’Why UIç»„ä»¶åŒ–ï¼Ÿ

<br>

ğŸš« æµè§ˆå™¨æ”¯æŒå°‘ä¸”å…¼å®¹æ€§è¾ƒå·®{.fragment}

ğŸ™… è¿œç¦»`jQuery`å‘½ä»¤å¼ä½æ•ˆç¼–ç¨‹{.fragment}

ğŸ’ ç»“åˆUIæ¨¡å—åŒ–æ›´æœ‰æ•ˆåœ°å¤ç”¨{.fragment}

ğŸ’ª è§£è€¦ç¨‹åº¦æ›´é«˜ä¾¿äºå•å…ƒæµ‹è¯•{.fragment}


---

<!-- .slide: data-background="http://linyu.dynv6.net:9001/images/ppt/mircofed/8c1001e93901213f59f4f4e259e736d12e2e95cd.gif" -->

<div style="background: #D2593E; color: #fff; width: 250px; height: 250px; border-radius: 50%; text-align: center; position: absolute; left: 18%; padding: 20px; opacity: .9; box-shadow: 0 0 10px #000;">
  <br>
  ç»„ç»‡
  <br>
  <p><small>æ¨¡å—ï¼Œç»„ä»¶</small></p>
</div>

<div style="background: #617A7F; color: #fff; width: 250px; height: 250px; border-radius: 50%; text-align: center; position: absolute; right: 18%; top: 190px; padding: 20px; opacity: .9; box-shadow: 0 0 10px #000;">
  <br>
  ä¼˜åŒ–
  <br>
  <p><small>å‹ç¼©ï¼Œä»£ç åˆ†å‰²ï¼ŒåŠ¨æ€åŠ è½½</small></p>
</div> 

<div style="background: #A8AB66; color: #fff; width: 250px; height: 250px; border-radius: 50%; text-align: center; padding: 20px; position: absolute; left: 20%; top: 380px; opacity: .9; box-shadow: 0 0 10px #000;">
  <br>
  ç”Ÿäº§
  <br>
  <p><small>æ‰“åŒ…ï¼Œå…±äº«åº“CDNï¼Œè‡ªåŠ¨è„šæœ¬CLI</small></p>
</div>

---

<!-- .slide: data-background="http://linyu.dynv6.net:9001/images/ppt/mircofed/9f510fb30f2442a7eaa460acdc43ad4bd1130214.gif" -->

<div style="background: #444; color: #fff; width: 250px; height: 250px; border-radius: 50%; text-align: center; position: absolute; left: 18%; padding: 20px; opacity: .9; box-shadow: 0 0 10px #000;">
  <br>
  ğŸŒ²ğŸŒ²ğŸŒ²
  <br>
  æˆé•¿
</div>

<div style="background: #444; color: #fff; width: 250px; height: 250px; border-radius: 50%; text-align: center; position: absolute; right: 18%; top: 190px; padding: 20px; opacity: .9; box-shadow: 0 0 10px #000;">
  <br>
  ğŸ„ğŸ„ğŸ„
  <br>
  å¢å¤š
  <br>
  ğŸµğŸµğŸµ
</div> 

<div style="background: #444; color: #fff; width: 250px; height: 250px; border-radius: 50%; text-align: center; padding: 20px; position: absolute; left: 20%; top: 380px; opacity: .9; box-shadow: 0 0 10px #000;">
  <br>
  âœ¨âœ¨
  <br>
  åº“âœ¨æ¡†æ¶
</div>

---

### å¾®å‰ç«¯

![](https://pic4.zhimg.com/v2-369aff8f4b18636dd33e2f26641d206c_1200x500.jpg)

ğŸ˜‡ æ—¢ç„¶æœåŠ¡ç«¯æœ‰å¾®æœåŠ¡ï¼Œå‰ç«¯ä¸ºä»€ä¹ˆä¸èƒ½æœ‰ï¼Ÿï¼Ÿ {style=font-size:36px;color:#999}

---

## Micro ä¼˜åŠ¿

<br>

ğŸš¤ èˆ¹å°å¥½æ‰å¤´æŠ€æœ¯é‡æ„ä¸ç”¨æ„{.fragment}

ğŸ’´ ä¸åŒä¸šåŠ¡é€‰åˆé€‚çš„æŠ€æœ¯æ¶æ„é¿å…æµªè´¹ (App Shell){.fragment}

ğŸ’ª ä¸¥æ ¼ä¸šåŠ¡åˆ’åˆ†é—®é¢˜å®šä½æ›´å¿«æ·{.fragment}

ğŸ¤ ç‹¬ç«‹éƒ¨ç½²è‡ªåŠ¨åŒ–æµ‹è¯•æ›´æ–°è¿­ä»£ä¸æ‹–æ²“{.fragment}

---

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/verticals-headline.png){style=width:80%;border-radius:15px}

å°å‹è‡ªæ²»æœåŠ¡é›†ç¾¤

---

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/QQ20191217-141407@2x.png){style=width:80%;border-radius:15px}

æ„å»ºå¤§å‹å¤æ‚åº”ç”¨ (App shell)

---

## åœºæ™¯åˆ†æ

<br>

å•å®ä¾‹ âœ” | å¤šå®ä¾‹
------|-------
åŒé¡µé¢å•åº”ç”¨ | åŒé¡µé¢æ··åˆå¤šåº”ç”¨ 
å…·å¤‡å®Œæ•´åº”ç”¨ç”Ÿå‘½å‘¨æœŸ | é€‚åˆç»„ä»¶ä¸šåŠ¡å°è£…è€Œéåº”ç”¨
{style=font-size:28px}

---

## å•ä¾‹æ–¹æ¡ˆ

<br>

ç°ä»£ âœ” | ä¼ ç»Ÿ (ä½“éªŒå·®é€šè®¯éš¾)
------|-------
æ³¨å†Œè·¯ç”± æ··åˆ SPA | æ•´é¡µè·³è½¬
[single-spa](https://single-spa.js.org/) Â· [qiankun](https://github.com/umijs/qiankun) âœ”| IFrame + postMessage
{style=font-size:28px}

---

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/QQ20191219-165208-HD.gif)

æŠ€æœ¯æ ˆæ— å…³ âœ” ç‹¬ç«‹å¼€å‘éƒ¨ç½² âœ” ç‹¬ç«‹è¿è¡Œæ—¶ âœ” {style=font-size:28px}

---

### ğŸŒ° code

::: block
```javascript
import * as Vue from "vue";
import App from "./App.vue";
import "./main.css";

import {
  registerMicroApps,
  setDefaultMountApp,
  runAfterFirstMounted,
  start
} from "qiankun";

window.Emitter = new Vue();

new Vue({
  el: "#root",
  render: h => h(App)
});

function render({ appContent, loading }) {
  document.querySelector("#loading").style.display = loading
    ? "block"
    : "none";
}

/** æ³¨å†Œæ‰€æœ‰å¾®åº”ç”¨ */
registerMicroApps(
  [
    {
      // Vue åº”ç”¨
      name: "AppVue",
      entry: "http://localhost:8081",
      render,
      activeRule: () => {
        return ~location.hash.search("#/app-vue");
      }
    },
    {
      // React åº”ç”¨
      name: "AppReact",
      entry: "http://localhost:8082",
      render,
      activeRule: () => {
        return ~location.hash.search("#/app-react");
      }
    }
  ],
  {
    beforeLoad: [
      app => {
        console.log("åº”ç”¨åŠ è½½å‰", app);
      }
    ],
    beforeMount: [
      app => {
        console.log("åº”ç”¨æŒ‚è½½å‰", app);
        window.Emitter.$emit('app.mounted', app.name);
      }
    ],
    afterUnmount: [
      app => {
        console.log("åº”ç”¨å¸è½½å", app);
        document.getElementById('container').innerHTML = '<h3>å¾®å‰ç«¯+dockeréƒ¨ç½²å±•ç¤º</h3>';
      }
    ]
  }
);

// setDefaultMountApp("/#/app-vue");
// runAfterFirstMounted(() => {
//   console.info("é¦–ä¸ªåº”ç”¨æŒ‚è½½å®Œæ¯•");
// });

start();
```
{style=font-size:24px}
:::
::: block
[é˜¿é‡Œä¹¾å¤](https://github.com/umijs/qiankun) | 
[ç§¯åˆ†å•†åŸæ´»åŠ¨æœåŠ¡ app shell](http://git.cairenhui.com/openx/microfed-bootstrap)
{style=font-size:18px}
:::

---

## MFEå¼€å‘éƒ¨ç½²æŒ‘æˆ˜

<br>

* æ“ä½œç³»ç»Ÿä¸åŒ

* nodeç‰ˆæœ¬ä¸åŒ

* å…¨å±€åŒ…é—æ¼æˆ–ç‰ˆæœ¬ä¸åŒ

* ç«¯å£å ç”¨çŠ¶å†µä¸åŒ

---

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/docker_logo_media_social_170.66666666667px_1213006_easyicon.net.png){style=border:none;box-shadow:none}

### Docker æ„å»ºå¼€å‘éƒ¨ç½²ç¯å¢ƒ

---

### ç®€ä»‹

![](http://linyu.dynv6.net:9001/images/ppt/mircofed/095016afpafos1zcan1ic3.jpg)

---

### å®è·µ

å°†ç°æœ‰é¡¹ç›®è½¬ä¸ºåŸºäº `Docker` ç¯å¢ƒå¼€å‘

---

## Dcokerfile

```dockerfile
# å¿…å¡« æŒ‡å®šåŸºç¡€é•œåƒ nodeç‰ˆæœ¬åœ¨è¿™é‡Œæœ€å¥½ç»Ÿä¸€
FROM node:12.13-alpine

# å¯è·Ÿ é¡¹ç›®ç‰ˆæœ¬ä¸€è‡´
LABEL version="1.0"

# å¯é€‰ ç»´æŠ¤äºº
LABEL maintainer="<linyupark@gmail.com>"

# å¯é€‰ è¯´æ˜
LABEL description="Docker Demo"

# å°†é¡¹ç›®æ–‡ä»¶å¯¼å…¥å·¥ä½œç›®å½•
COPY . /data/

# æŒ‡å®šå‘½ä»¤è¿è¡Œç›®å½•
WORKDIR /data

# æš´éœ²é¡¹ç›®ä¼šç”¨åˆ°çš„ç«¯å£
EXPOSE 3000

# åˆ›å»ºæ—¶å®‰è£…ä¾èµ–
RUN \
npm config set registry https://registry.npm.taobao.org && \
npm install

CMD ["npm", "start"]
```

---

## docker-compose

```yaml
version: '3'
services: 
  app-shell:
    # dockerfile ä½ç½®
    build: ./app-shell
    # æŒ‚è½½å·
    volumes: 
      - ./app-shell/src:/data/src
    # å®¹å™¨å¯¹åº”æœ¬åœ°æ˜ å°„ç«¯å£
    ports:
      - "8080:8080"
    # è‡ªå¯åŠ¨æœåŠ¡
    # restart: always
  app-vue:
    # dockerfile ä½ç½®
    build: ./app-vue
    # æŒ‚è½½å·
    volumes: 
      - ./app-vue/src:/data/src
    # å®¹å™¨å¯¹åº”æœ¬åœ°æ˜ å°„ç«¯å£
    ports:
      - "8081:8081"

    # è‡ªå¯åŠ¨æœåŠ¡
    # restart: always
  app-react:
    # dockerfile ä½ç½®
    build: ./app-react
    # æŒ‚è½½å·
    volumes: 
      - ./app-react/src:/data/src
    # å®¹å™¨å¯¹åº”æœ¬åœ°æ˜ å°„ç«¯å£
    ports:
      - "8082:8082"
    # è‡ªå¯åŠ¨æœåŠ¡
    # restart: always
```

---

## æ¼”ç¤º&æé—®

THANKS